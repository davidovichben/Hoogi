<div class="page-container" [attr.dir]="lang.currentLanguage === 'he' ? 'rtl' : 'ltr'">
  <!-- Back Button -->
  <div class="back-button-wrapper">
    <button class="back-button" (click)="goBack()">
      <svg [class.rotate-180]="lang.currentLanguage === 'en'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
      <span>{{ lang.t('common.back') }}</span>
    </button>
  </div>

  <!-- Header with business name -->
  <div class="header-section">
    <div class="header-card">
      <h1 class="header-title">
        {{ formData.businessName || lang.t('user.name') }} -
        {{ (formData.subOccupation && formData.subOccupation !== OTHER ? formData.subOccupation : formData.subOccupationFree) ||
           (formData.occupation && formData.occupation !== OTHER ? formData.occupation : formData.occupationFree) ||
           lang.t('user.businessType') }}
      </h1>
    </div>
  </div>

  <!-- Logo and Profile Picture section -->
  <div class="media-section">
    <div class="media-card">
      <div class="media-container">
        <!-- Logo section -->
        <div class="media-item">
          <input
            type="checkbox"
            [(ngModel)]="formData.showLogo"
            class="media-checkbox">
          @if (formData.logoUrl) {
            <img
              [src]="formData.logoUrl"
              alt="Logo"
              class="media-image"
              [style.border-color]="formData.primaryColor + '33'">
          } @else {
            <div class="media-placeholder">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
          }
          <span class="media-label">{{ lang.t('createQuestionnaire.showLogo') }}</span>
        </div>

        <!-- Profile Picture section -->
        <div class="media-item">
          <input
            type="checkbox"
            [(ngModel)]="formData.showProfileImage"
            class="media-checkbox">
          @if (formData.imageUrl) {
            <img
              [src]="formData.imageUrl"
              alt="Profile"
              class="media-image"
              [style.border-color]="formData.primaryColor + '33'">
          } @else {
            <div class="media-placeholder">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
          }
          <span class="media-label">{{ lang.t('createQuestionnaire.showProfileImage') }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="content-wrapper">
    <!-- Main form section -->
    <div class="form-section">
      <!-- Title input -->
      <div class="title-card card">
        <h3 class="card-title">
          {{ lang.t('createQuestionnaire.questionnaireTitle') }}
          <span style="color: #EF4444; margin-inline-start: 4px;">*</span>
        </h3>
        <input
          type="text"
          [(ngModel)]="formData.title"
          [placeholder]="lang.t('createQuestionnaire.questionnaireTitlePlaceholder')"
          class="form-input"
          [style.--focus-ring-color]="formData.primaryColor"
          required>
      </div>

      <!-- Description input -->
      <div class="description-card card">
        <h3 class="card-title">{{ lang.t('createQuestionnaire.descriptionOptional') }}</h3>
        <textarea
          [(ngModel)]="formData.description"
          [placeholder]="lang.t('createQuestionnaire.descriptionPlaceholder')"
          class="form-textarea"
          [style.--focus-ring-color]="formData.primaryColor"></textarea>
      </div>

      <!-- Link or Image upload -->
      <div class="link-card card">
        <h3 class="card-title">{{ lang.t('createQuestionnaire.fileOrLink') }}</h3>
        <div class="link-file-container">
          <div class="link-file-group">
            <label class="link-file-label">{{ lang.t('createQuestionnaire.link') }}</label>
            <input
              type="text"
              [(ngModel)]="formData.linkUrl"
              [placeholder]="lang.t('createQuestionnaire.linkPlaceholder')"
              class="form-input"
              [style.--focus-ring-color]="formData.primaryColor">
          </div>
          <div class="link-file-group">
            <label class="link-file-label">{{ lang.t('createQuestionnaire.uploadFile') }}</label>
            <div class="file-input-wrapper">
              <input
                type="file"
                id="attachmentFileInput"
                (change)="onAttachmentSelected($event)"
                accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"
                class="file-input-hidden">
              <button
                type="button"
                (click)="triggerFileUpload()"
                class="file-button"
                [title]="attachmentFileName">
                {{ attachmentFileName ? getTrimmedFileName(attachmentFileName) : (uploadingAttachment ? lang.t('common.loading') : lang.t('createQuestionnaire.chooseFile')) }}
              </button>
              @if (attachmentFileName) {
                <button
                  type="button"
                  (click)="removeAttachment()"
                  class="remove-button">
                  {{ lang.t('common.remove') }}
                </button>
              }
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Build Questionnaire - full width card -->
    <div class="questions-card" (click)="openQuestionsDialog()">
      <div class="questions-header">
        <div class="questions-icon-bg">
          <svg class="questions-icon-color" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
        </div>
        <div>
          <h2 class="questions-title">
            {{ lang.t('createQuestionnaire.buildQuestionnaire') }}
            <span style="color: #EF4444; margin-inline-start: 4px;">*</span>
          </h2>
          <p class="questions-subtitle">{{ lang.t('createQuestionnaire.questionCreationDesc') }}</p>
        </div>
      </div>
      @if (formData.questions && formData.questions.length > 0) {
        <div class="questions-badge">
          <p class="questions-badge-text">
            {{ formData.questions.length }} {{ lang.currentLanguage === 'he' ? 'שאלות נוספו לשאלון' : 'questions added to questionnaire' }}
          </p>
        </div>
      } @else {
        <div class="questions-badge" style="background-color: #FEE2E2; border-color: #FCA5A5;">
          <p class="questions-badge-text" style="color: #DC2626;">
            {{ lang.currentLanguage === 'he' ? 'לא נוספו שאלות - לחץ להוספת שאלות' : 'No questions added - Click to add questions' }}
          </p>
        </div>
      }
    </div>

    <!-- Automation Settings - full width card -->
    <div class="automation-card card">
      <h3 class="card-title">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-left: 8px;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
        {{ lang.t('createQuestionnaire.automationSettings') }}
      </h3>

      <!-- Enable automation checkbox -->
      <div class="automation-toggle">
        <label class="toggle-label">
          <input
            type="checkbox"
            [(ngModel)]="automationEnabled"
            class="toggle-checkbox">
          <span class="toggle-text">{{ lang.t('createQuestionnaire.enableAutomation') }}</span>
        </label>
      </div>

      <!-- Select saved template -->
      @if (automationEnabled) {
        <div class="automation-settings-content">
          <div class="automation-field">
            <label class="automation-label">{{ lang.t('createQuestionnaire.selectTemplate') }}</label>
            <select [(ngModel)]="formData.automationTemplateId" class="form-select">
              <option [value]="null">{{ lang.t('createQuestionnaire.selectTemplatePlaceholder') }}</option>
              @for (template of savedTemplates; track template.id) {
                <option [value]="template.id">
                  @if (template.templateType === 'standard') { ⭐ }
                  @if (template.templateType === 'ai') { 🤖 }
                  @if (template.templateType === 'personal') { 👤 }
                  @if (template.templateType === 'combined') { 🤝 }
                  {{ template.name }}
                </option>
              }
            </select>
          </div>
        </div>
      }
    </div>

    <!-- Save and Distribute buttons at bottom - centered -->
    <div class="action-buttons">
      <button
        (click)="publishQuestionnaire()"
        [disabled]="saving"
        class="save-btn">
        {{ saving ? lang.t('common.loading') : lang.t('common.save') }}
      </button>
      <button
        (click)="saveAndPublish()"
        [disabled]="saving"
        class="distribute-btn">
        {{ saving ? lang.t('common.loading') : lang.t('onboarding.publish') }}
      </button>
    </div>
  </div>
</div>
