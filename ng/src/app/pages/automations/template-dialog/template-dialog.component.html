@if (isOpen) {
  <!-- Backdrop -->
  <div class="dialog-backdrop" (click)="onClose()"></div>

  <!-- Dialog -->
  <div class="dialog-container" [class.rtl]="lang.currentLanguage === 'he'">
    <div class="dialog-content">
      <!-- Header -->
      <div class="dialog-header">
        <h2 class="dialog-title">{{ lang.t('templates.createNew') }}</h2>
        <button class="close-button" (click)="onClose()">×</button>
      </div>

      <!-- Form -->
      <div class="dialog-body">
        <!-- Template Name -->
        <div class="form-group">
          <label class="form-label">{{ lang.t('templates.name') }}</label>
          <input
            type="text"
            [(ngModel)]="formData.name"
            [placeholder]="lang.t('templates.namePlaceholder')"
            class="form-input">
        </div>

        <!-- Template Type -->
        <div class="form-group">
          <label class="form-label">{{ lang.t('templates.type') }}</label>
          <select [(ngModel)]="formData.type" class="form-input">
            <option value="standard">{{ lang.t('templates.typeStandard') }}</option>
            <option value="ai">{{ lang.t('templates.typeAI') }}</option>
            <option value="custom">{{ lang.t('templates.typeCustom') }}</option>
          </select>
        </div>

        <!-- Email Subject -->
        <div class="form-group">
          <label class="form-label">{{ lang.t('templates.emailSubject') }}</label>
          <input
            type="text"
            [(ngModel)]="formData.subject"
            [placeholder]="lang.t('templates.emailSubjectPlaceholder')"
            class="form-input">
        </div>

        <!-- Message Body -->
        <div class="form-group">
          <label class="form-label">{{ lang.t('templates.messageBody') }}</label>
          <textarea
            [(ngModel)]="formData.body"
            [placeholder]="lang.t('templates.messageBodyPlaceholder')"
            class="form-textarea"
            rows="6"></textarea>
        </div>

        <!-- Supported Fields -->
        <div class="supported-fields">
          <button
            type="button"
            class="supported-fields-toggle"
            (click)="toggleSupportedFields()">
            <span class="toggle-icon" [class.open]="showSupportedFields">▼</span>
            <span>{{ lang.t('templates.supportedFields') }}</span>
          </button>

          @if (showSupportedFields) {
            <div class="fields-grid">
              @for (field of supportedFields; track field.key) {
                <button type="button" class="field-tag" (click)="insertField(field.key)">{{ field.key }}</button>
              }
            </div>
          }
        </div>

        <!-- Make Default Toggle -->
        <div class="form-group-toggle">
          <label class="toggle-label">
            <input type="checkbox" [(ngModel)]="formData.isDefault">
            <span>{{ lang.t('templates.makeDefault') }}</span>
          </label>
        </div>
      </div>

      <!-- Footer -->
      <div class="dialog-footer">
        <button class="btn-cancel" (click)="onClose()">
          {{ lang.t('common.cancel') }}
        </button>
        <button
          class="btn-save"
          (click)="onSave()"
          [disabled]="!formData.name || !formData.subject || !formData.body">
          {{ lang.t('common.save') }}
        </button>
      </div>
    </div>
  </div>
}
