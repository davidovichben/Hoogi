<div class="reset-password-container">
  <div class="reset-password-card">
    <h1 class="title">{{ lang.t('updatePassword.title') }}</h1>

    <form (submit)="handleSubmit(); $event.preventDefault()" class="form">
      @if (email) {
        <div class="email-info">
          {{ lang.t('updatePassword.codeSentTo') }} <strong>{{ email }}</strong>
        </div>
      }

      @if (!isCodeComplete) {
        <div>
          <label class="label">{{ lang.t('updatePassword.sixDigitCode') }}</label>
          <div class="digits-container">
            <input
              #digit1
              type="text"
              inputmode="numeric"
              pattern="[0-9]*"
              [(ngModel)]="digits[0]"
              (input)="onDigitInput($event, 0)"
              (keydown)="onDigitKeydown($event, 0)"
              (paste)="onPaste($event)"
              name="digit1"
              maxlength="1"
              autocomplete="off"
              class="digit-input"
              [class.filled]="digits[0]">
            <input
              #digit2
              type="text"
              inputmode="numeric"
              pattern="[0-9]*"
              [(ngModel)]="digits[1]"
              (input)="onDigitInput($event, 1)"
              (keydown)="onDigitKeydown($event, 1)"
              (paste)="onPaste($event)"
              name="digit2"
              maxlength="1"
              autocomplete="off"
              class="digit-input"
              [class.filled]="digits[1]">
            <input
              #digit3
              type="text"
              inputmode="numeric"
              pattern="[0-9]*"
              [(ngModel)]="digits[2]"
              (input)="onDigitInput($event, 2)"
              (keydown)="onDigitKeydown($event, 2)"
              (paste)="onPaste($event)"
              name="digit3"
              maxlength="1"
              autocomplete="off"
              class="digit-input"
              [class.filled]="digits[2]">
            <input
              #digit4
              type="text"
              inputmode="numeric"
              pattern="[0-9]*"
              [(ngModel)]="digits[3]"
              (input)="onDigitInput($event, 3)"
              (keydown)="onDigitKeydown($event, 3)"
              (paste)="onPaste($event)"
              name="digit4"
              maxlength="1"
              autocomplete="off"
              class="digit-input"
              [class.filled]="digits[3]">
            <input
              #digit5
              type="text"
              inputmode="numeric"
              pattern="[0-9]*"
              [(ngModel)]="digits[4]"
              (input)="onDigitInput($event, 4)"
              (keydown)="onDigitKeydown($event, 4)"
              (paste)="onPaste($event)"
              name="digit5"
              maxlength="1"
              autocomplete="off"
              class="digit-input"
              [class.filled]="digits[4]">
            <input
              #digit6
              type="text"
              inputmode="numeric"
              pattern="[0-9]*"
              [(ngModel)]="digits[5]"
              (input)="onDigitInput($event, 5)"
              (keydown)="onDigitKeydown($event, 5)"
              (paste)="onPaste($event)"
              name="digit6"
              maxlength="1"
              autocomplete="off"
              class="digit-input"
              [class.filled]="digits[5]">
          </div>
          @if (isVerifyingCode) {
            <div class="timer verifying">
              {{ lang.t('updatePassword.verifyingCode') }}
            </div>
          } @else if (timeLeft > 0) {
            <div class="timer" [class.warning]="timeLeft <= 60">
              {{ lang.t('updatePassword.codeExpiresIn') }} {{ timeLeftFormatted }}
            </div>
          } @else if (timeLeft === 0) {
            <div class="timer expired">
              {{ lang.t('updatePassword.codeExpired') }}
            </div>
          }
        </div>

        <!-- Resend Code Section -->
        <div class="resend-section">
          @if (cooldownTimeLeft > 0) {
            <div class="cooldown-message">
              {{ lang.t('updatePassword.canResendIn') }} {{ cooldownMinutes }} {{ lang.t('updatePassword.minutes') }}
            </div>
          } @else {
            <button
              type="button"
              (click)="resendCode()"
              [disabled]="!canResend"
              class="resend-btn">
              {{ isResending ? lang.t('updatePassword.resending') : lang.t('updatePassword.resendCode') }}
            </button>
            @if (resendAttempts > 0 && resendAttempts < maxResendAttempts) {
              <div class="attempts-info">
                {{ remainingAttempts }} {{ lang.t('updatePassword.attemptsRemaining') }}
              </div>
            }
          }
        </div>
      }

      @if (isCodeComplete) {
        <div>
          <label class="label">{{ lang.t('updatePassword.newPassword') }}</label>
          <input
            type="password"
            [(ngModel)]="password"
            name="password"
            required
            class="input">
        </div>

        <div>
          <label class="label">{{ lang.t('updatePassword.confirmPassword') }}</label>
          <input
            type="password"
            [(ngModel)]="confirmPassword"
            name="confirmPassword"
            required
            class="input">
        </div>
      }

      <button
        type="submit"
        [disabled]="isLoading || timeLeft === 0 || !isCodeComplete || !password || !confirmPassword"
        class="submit-btn">
        {{ isLoading ? lang.t('updatePassword.resetting') : lang.t('updatePassword.resetPassword') }}
      </button>

      <button
        type="button"
        (click)="goBack()"
        class="back-btn">
        {{ lang.t('updatePassword.backToLogin') }}
      </button>
    </form>
  </div>
</div>
