<div class="mx-auto p-6 space-y-6 w-[96%]" [class.rtl]="lang.currentLanguage === 'he'" dir="rtl">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-semibold">{{ lang.t('questionnaires.title') }}</h1>
    <button
      (click)="goToOnboarding()"
      class="px-6 py-3 text-white rounded-lg font-semibold shadow-md"
      style="background-color: hsl(186, 74%, 35%);"
      onmouseover="this.style.backgroundColor='hsl(186, 74%, 30%)'"
      onmouseout="this.style.backgroundColor='hsl(186, 74%, 35%)'">
      {{ lang.t('questionnaires.create') }}
    </button>
  </div>

  <!-- Loading State -->
  @if (loading) {
    <div class="p-6">{{ lang.t('questionnaires.loading') }}</div>
  }

  <!-- Error State -->
  @if (error) {
    <div class="p-6 text-red-600">{{ error }}</div>
  }

  <!-- Questionnaires Grid -->
  @if (!loading && !error) {
    <div class="space-y-3">
      @for (q of questionnaires; track q.id; let index = $index) {
        <div class="rounded-lg shadow-sm border p-6 hover:shadow-md transition-shadow" [ngClass]="getCardColor(index)">

          <!-- Top section: Status, Title, Stats -->
          <div class="mb-6">
            <div class="flex items-center justify-between gap-4">
              <button
                (click)="toggleActive(q.id)"
                class="px-3 py-1 rounded-full text-sm font-medium cursor-pointer hover:opacity-80 transition-opacity"
                [ngClass]="q.status === 'active' ? 'bg-teal-500 text-white' : 'bg-gray-300 text-gray-700'">
                {{ q.status === 'active' ? lang.t('questionnaires.active') : lang.t('questionnaires.draft') }}
              </button>

              <div class="text-right flex-1">
                <h3 class="font-semibold text-lg mb-1">{{ q.title || lang.t('questionnaires.untitled') }}</h3>
                <p class="text-sm text-gray-600">{{ lang.t('questionnaires.createdAt') }} {{ q.created_at ? (q.created_at | date:'d.M.yyyy') : '3.10.2025' }}</p>
              </div>

              <div class="flex gap-4">
                <div class="text-center cursor-pointer">
                  <div class="text-2xl font-bold text-teal-600">{{ respCount[q.id] || 0 }}</div>
                  <div class="text-xs text-gray-600">{{ lang.t('questionnaires.responses') }}</div>
                </div>
                <div class="text-center cursor-pointer">
                  <div class="text-2xl font-bold text-green-600">{{ leadCount[q.id] || 0 }}</div>
                  <div class="text-xs text-gray-600">{{ lang.t('questionnaires.leads') }}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Action buttons -->
          <div class="mb-6 grid grid-cols-6 gap-2">
            <button
              (click)="handleView(q.id)"
              class="flex flex-col items-center gap-1.5 py-3 px-2 rounded-lg hover:bg-teal-50 transition-colors">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-600">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
              <span class="text-xs font-medium">{{ lang.t('questionnaires.view') }}</span>
            </button>

            <button
              (click)="handleDistribute(q.id)"
              class="flex flex-col items-center gap-1.5 py-3 px-2 rounded-lg hover:bg-teal-50 transition-colors">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-600">
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
              </svg>
              <span class="text-xs font-medium">{{ lang.t('questionnaires.distribute') }}</span>
            </button>

            <button
              (click)="handleEdit(q.id)"
              class="flex flex-col items-center gap-1.5 py-3 px-2 rounded-lg hover:bg-gray-100 transition-colors">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
              <span class="text-xs font-medium">{{ lang.t('questionnaires.edit') }}</span>
            </button>

            <button
              (click)="handleDuplicate(q)"
              class="flex flex-col items-center gap-1.5 py-3 px-2 rounded-lg hover:bg-gray-100 transition-colors">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              <span class="text-xs font-medium">{{ lang.t('questionnaires.duplicate') }}</span>
            </button>

            <button
              class="flex flex-col items-center gap-1.5 py-3 px-2 rounded-lg hover:bg-teal-50 transition-colors">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-600">
                <line x1="12" y1="20" x2="12" y2="10"></line>
                <line x1="18" y1="20" x2="18" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="16"></line>
              </svg>
              <span class="text-xs font-medium">{{ lang.t('questionnaires.data') }}</span>
            </button>

            <button
              (click)="handleDelete(q)"
              class="flex flex-col items-center gap-1.5 py-3 px-2 rounded-lg hover:bg-red-50 transition-colors">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-600">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
              <span class="text-xs font-medium">{{ lang.t('common.delete') }}</span>
            </button>
          </div>

          <!-- Bottom section: Sources and Partners -->
          <div class="pt-4 border-t border-gray-200/50 grid grid-cols-2 gap-3">
            <!-- Lead Sources -->
            <div class="bg-gray-100/50 rounded-lg p-3">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-teal-600">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                  </svg>
                  <h4 class="font-semibold text-sm">{{ lang.t('questionnaires.leadSources') }}</h4>
                </div>
                <div class="flex gap-2 text-xs">
                  <span class="text-teal-600">15 {{ lang.t('questionnaires.total') }}</span>
                  <span class="text-gray-400">/</span>
                  <span class="text-green-600">5 {{ lang.t('questionnaires.new') }}</span>
                </div>
              </div>
              <div class="flex flex-wrap gap-1.5">
                <span class="bg-gray-100 border border-gray-200 px-2 py-1.5 rounded text-xs">פייסבוק (15 / 5)</span>
                <span class="bg-gray-100 border border-gray-200 px-2 py-1.5 rounded text-xs">אינסטגרם (12 / 4)</span>
              </div>
            </div>

            <!-- Partners -->
            <div class="bg-gray-100/30 rounded-lg p-3">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-teal-600">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                  </svg>
                  <h4 class="font-semibold text-sm">{{ lang.t('questionnaires.partners') }}</h4>
                </div>
                <div class="flex gap-2 text-xs">
                  <span class="text-teal-600">32 {{ lang.t('questionnaires.total') }}</span>
                  <span class="text-gray-400">/</span>
                  <span class="text-green-600">12 {{ lang.t('questionnaires.new') }}</span>
                </div>
              </div>
              <div class="flex flex-wrap gap-1.5">
                <span class="bg-slate-100 border border-slate-200 px-2 py-1.5 rounded text-xs">דני כהן (15 / 6)</span>
                <span class="bg-slate-100 border border-slate-200 px-2 py-1.5 rounded text-xs">יעל לוי (10 / 4)</span>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Empty State -->
  @if (!loading && !error && questionnaires.length === 0) {
    <div class="text-center py-12 text-gray-600">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mx-auto mb-4 opacity-50">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      <p>{{ lang.t('questionnaires.noQuestionnaires') }}</p>
    </div>
  }
</div>
